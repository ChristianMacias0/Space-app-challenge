<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <title>Space Apps - Air Quality</title>
</head>
<body>
    <h1>Space Apps - Air Quality</h1>
    <p>
        <a href="/download/">Iniciar descarga</a> |
        <a href="/plot/">Generar plots</a> |
        <a href="/excel/">Generar y descargar Excel</a>
    </p>

    <div id="status-box" style="margin:10px 0;padding:10px;border:1px solid #ccc">
        Estado: <strong id="dl-state">desconocido</strong>
        <div id="dl-msg"></div>
    </div>

    <h2>Imágenes generadas</h2>
    {% if images %}
        {% for img in images %}
            <div style="margin-bottom:10px;">
                <img src="/static/air_quality/plots/{{ img }}" alt="{{ img }}" style="max-width:600px;" />
            </div>
        {% endfor %}
    {% else %}
        <p>No hay imágenes generadas. Ejecuta "Generar plots" después de descargar datos.</p>
    {% endif %}

    <script>
        async function fetchStatus(){
            try{
                const resp = await fetch('/status/');
                const data = await resp.json();
                document.getElementById('dl-state').textContent = data.state || 'desconocido';
                document.getElementById('dl-msg').textContent = data.message || '';
                // si finalizó con archivos, refrescar la página para mostrar imágenes
                if(data.state === 'done'){
                    if((data.files || []).length > 0){
                        // reload para mostrar imágenes nuevas
                        location.reload();
                    }
                }
            }catch(e){
                console.warn('No se pudo obtener el estado', e);
            }
        }

        // Poll cada 5s
        setInterval(fetchStatus, 5000);
        // fetch inicial
        fetchStatus();
    </script>
</body>
</html>
